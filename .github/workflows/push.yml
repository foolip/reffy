on:
  push:
    branches:
    - master
name: master
jobs:
  crawl:
    runs-on: ubuntu-18.04
    steps:
    - name: checkout reffy
      uses: actions/checkout@master
    - name: checkout reffy-reports
      uses: actions/checkout@master
      with:
        repository: foolip/reffy-reports
        token: ${{ secrets.REFFY_REPORTS_TOKEN }}
        path: reffy-reports
    - uses: actions/setup-node@master
      with:
        node-version: '10.x'
    - name: install pandoc
      run: sudo apt-get install pandoc
    - name: npm install
      run: npm ci
    - name: create config.json
      run: echo "${{ secrets.CONFIG_JSON }}" | base64 --decode > config.json
    - name: crawl
      run: npm run whatwg
    - run: git status
    - run: find reports
